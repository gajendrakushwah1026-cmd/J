<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>JITU | Free Notes & Video Lectures</title>
    <meta name="description" content="JITU Vault provides high-quality Class 11 Science study material. Get free notes and video lectures.">
    
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7037140892556243"
     crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root { --pw-blue: #5a4bda; --bg: #f8f9fd; }
        body { font-family: 'Outfit', sans-serif; background-color: var(--bg); color: #1e2937; margin: 0; overflow-x: hidden; scroll-behavior: smooth; }
        h1, h2, h3, h4, span, p, button, input { font-style: normal !important; }

        .platform-card { border: 2px solid #eef2f6; background: white; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); cursor: pointer; position: relative; overflow: hidden; }
        .platform-card.active { border-color: var(--pw-blue); background: #f5f3ff; transform: translateY(-4px); box-shadow: 0 15px 30px -10px rgba(90, 75, 218, 0.2); }
        .platform-card.active::after { content: 'SELECTED'; position: absolute; top: 10px; right: 10px; font-size: 8px; font-weight: 600; background: var(--pw-blue); color: white; padding: 2px 8px; border-radius: 4px; }

        .sub-pill { border: 2px solid #e2e8f0; background: #ffffff; color: #475569; transition: all 0.3s ease; }
        .sub-pill.active { background: var(--pw-blue); color: white; border-color: var(--pw-blue); box-shadow: 0 10px 15px -3px rgba(90, 75, 218, 0.3); transform: translateY(-2px); }
        .glass-nav { background: rgba(255, 255, 255, 0.98); backdrop-filter: blur(10px); border-bottom: 1px solid #eef2f6; }
        
        .chapter-accordion { background: white; border: 1px solid #eef2f6; border-radius: 24px; overflow: hidden; margin-bottom: 1rem; transition: all 0.3s ease; }
        .chapter-header { padding: 1.5rem; cursor: pointer; display: flex; align-items: center; justify-content: space-between; transition: background 0.2s; }
        .chapter-header:hover { background: #fcfcff; }
        .chapter-content { display: none; padding: 0 1.5rem 1.5rem 1.5rem; border-top: 1px solid #f8fafc; }
        .chapter-accordion.open .chapter-content { display: block; }
        .chapter-accordion.open { border-color: var(--pw-blue); box-shadow: 0 10px 20px -5px rgba(90, 75, 218, 0.1); }

        .resource-card { background: #f8fafc; border-radius: 16px; padding: 1rem; margin-bottom: 0.75rem; border: 1px solid transparent; transition: all 0.2s; }
        .resource-card:hover { border-color: #cbd5e1; background: white; }

        #globalLoader { position: fixed; inset: 0; background: #ffffff; display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 9999; }
        .spinner { width: 40px; height: 40px; border: 3px solid #f3f3f3; border-top: 3px solid var(--pw-blue); border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .hero-gradient { background: linear-gradient(135deg, #1e1b4b 0%, #312e81 100%); }
        .footer-card { background: white; border: 1px solid #eef2f6; border-radius: 2rem; padding: 2.5rem; }
    </style>
</head>
<body>

<div id="globalLoader">
    <div class="spinner"></div>
    <p class="mt-4 text-[10px] font-semibold uppercase tracking-widest text-indigo-600">ü§ì Wait Website Is Loading...</p>
</div>

<header class="sticky top-0 z-50">
    <nav class="glass-nav px-6 py-4">
        <div class="max-w-7xl mx-auto flex items-center justify-between">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-[#5a4bda] rounded-xl flex items-center justify-center text-white font-semibold text-xl shadow-lg">J</div>
                <div class="flex flex-col">
                    <span class="text-lg font-semibold tracking-tight text-gray-900 leading-none uppercase">JITU Premium Resources</span>
                    <span class="text-[8px] font-semibold text-indigo-500 uppercase tracking-widest mt-1">Premium Education Material</span>
                </div>
            </div>
            <div class="flex items-center gap-2">
                <button id="addBtn" onclick="openAddModal()" class="hidden bg-green-600 text-white px-4 py-2 rounded-lg text-[10px] font-semibold uppercase">Add Content</button>
                <button id="adminBtn" onclick="openLoginModal()" class="bg-gray-100 text-gray-600 px-4 py-2 rounded-lg text-[10px] font-semibold uppercase">Admin</button>
            </div>
        </div>
    </nav>
</header>

<section class="hero-gradient pt-16 pb-24 px-6 text-center text-white">
    <div class="max-w-5xl mx-auto">
        <h1 class="text-4xl md:text-6xl font-semibold tracking-tight leading-none mb-6 uppercase">
            Class 11 Science <br> <span class="text-indigo-400">Free Study Materials. ‚ò∫Ô∏è</span>
        </h1>
        <p class="text-indigo-100/70 text-sm font-medium uppercase tracking-widest">Physics ‚Ä¢ Chemistry ‚Ä¢ Maths ‚Ä¢ Biology ‚Ä¢ English</p>
    </div>
</section>

<section class="bg-white px-6 pt-4 pb-6">
    <div class="max-w-3xl mx-auto">
        <p class="text-[10px] font-semibold text-gray-400 uppercase tracking-widest mb-4 text-center">Choose Your Platform</p>
        <div class="grid grid-cols-2 gap-4">
            <div id="plat-PW" onclick="selectPlatform('PW')" class="platform-card p-6 rounded-[2.5rem] flex flex-col items-center gap-4 active">
                <img src="https://i.ibb.co/7tTCGV81/download.png" class="w-20 h-20 object-contain rounded-full border-4 border-white shadow-md" alt="PW Logo">
                <span class="text-sm font-semibold uppercase text-gray-800 tracking-tight">Physics Wallah</span>
            </div>
            <div id="plat-NT" onclick="selectPlatform('NT')" class="platform-card p-6 rounded-[2.5rem] flex flex-col items-center gap-4">
                <img src="https://i.ibb.co/ks97sGmS/download-1.png" class="w-20 h-20 object-contain rounded-full border-4 border-white shadow-md" alt="NT Logo">
                <span class="text-sm font-semibold uppercase text-gray-800 tracking-tight">Next Toppers</span>
            </div>
        </div>
    </div>
</section>

<div id="explore" class="bg-white border-b border-gray-100 px-4 py-6 sticky top-[72px] z-40">
    <div class="max-w-3xl mx-auto overflow-x-auto flex gap-3 no-scrollbar" id="subjectList"></div>
</div>

<main class="p-6 md:p-12">
    <div class="max-w-3xl mx-auto">
        <div class="mb-10">
            <input id="searchInput" type="text" placeholder="Search Chapter or Lecture..." class="w-full bg-white border-2 border-gray-100 px-6 py-4 rounded-2xl outline-none focus:border-indigo-500 transition-all shadow-sm font-medium">
        </div>

        <div id="verticalContent" class="space-y-4"></div>
        
        <div id="emptyState" class="text-center py-20 hidden">
            <p class="text-xl font-semibold text-gray-300 uppercase">No Content Found...</p>
        </div>

        <div class="mt-40 space-y-16">
            <div id="about-us" class="footer-card">
                <h2 class="text-3xl font-semibold uppercase text-indigo-900 mb-8 border-b-4 border-indigo-600 inline-block">About Us</h2>
                <p class="text-lg text-gray-700 leading-relaxed font-medium">JITU VAULT ek educational platform hai jo specially Class 11 Science ke students ko dhyan mein rakkar banaya gaya hai. Humara mission har student ko Physics Wallah (PW) aur Next Toppers (NT) ke premium quality lectures aur handwritten notes free of cost provide karna hai.</p>
            </div>

            <div id="contact-us" class="footer-card bg-indigo-50">
                <h2 class="text-3xl font-semibold uppercase text-indigo-900 mb-8 border-b-4 border-indigo-600 inline-block">Contact Us</h2>
                <p class="text-lg text-gray-700 leading-relaxed font-medium mb-8">Agar aapko resources access karne mein koi dikkat ho rahi hai ya aap koi feedback dena chahte hain, toh humein contact karein, gmail - gajendrakushwah1027@gmail.com</p>
                <div class="flex flex-wrap gap-6">
                    <a href="https://youtube.com/@notjitu1022?si=ZivLdwErKW40-_87" class="bg-red-600 text-white px-8 py-4 rounded-2xl text-xs font-semibold uppercase shadow-lg">YouTube Support</a>
                    <a href="https://www.instagram.com/notjitu_fz/" class="bg-purple-600 text-white px-8 py-4 rounded-2xl text-xs font-semibold uppercase shadow-lg">Instagram</a>
                </div>
            </div>

            <div id="privacy-policy" class="footer-card">
                <h2 class="text-3xl font-semibold uppercase text-indigo-900 mb-8 border-b-4 border-indigo-600 inline-block">Privacy Policy</h2>
                <p class="text-lg text-gray-700 leading-relaxed font-medium">Hum JITU VAULT par aapki privacy ka pura dhyan rakhte hain. Hum kisi bhi tarah ka personal data ya tracking nahi karte. Humari website par sirf educational content aur Google AdSense ka use hota hai.</p>
            </div>

            <div id="disclaimer" class="footer-card">
                <h2 class="text-3xl font-semibold uppercase text-indigo-900 mb-8 border-b-4 border-indigo-600 inline-block">Disclaimer</h2>
                <p class="text-lg text-gray-700 leading-relaxed font-medium">JITU VAULT kisi bhi official educational board ya sarkari sanstha se juda hua nahi hai. Yahan diya gaya sara material sirf educational purpose ke liye hai.</p>
            </div>
        </div>
    </div>
</main>

<div id="modalOverlay" class="fixed inset-0 bg-gray-950/90 backdrop-blur-xl hidden z-[100] items-center justify-center p-6 opacity-0 transition-all duration-300">
    
    <div id="downloadStepModal" class="bg-white rounded-[2.5rem] w-full max-w-md p-8 hidden shadow-2xl border-4 border-indigo-600">
        <div class="text-center">
            <div class="w-16 h-16 bg-green-100 text-green-600 rounded-full flex items-center justify-center mx-auto mb-4">
                <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path></svg>
            </div>
            <h3 class="text-xl font-semibold uppercase text-indigo-900 mb-2">Lecture Link Copied ‚úÖ</h3>
            <p class="text-gray-500 text-[10px] font-semibold uppercase tracking-widest mb-6">Ab niche diye steps follow kareinüëá</p>
            
            <div class="text-left space-y-4 mb-8">
                <div class="flex gap-4 items-start">
                    <span class="bg-indigo-600 text-white w-6 h-6 rounded-md flex-shrink-0 flex items-center justify-center text-xs font-semibold">1</span>
                    <p class="text-sm font-medium text-gray-700">m3u8.dev website par jaakar link *Paste* karein.</p>
                </div>
                <div class="flex gap-4 items-start">
                    <span class="bg-indigo-600 text-white w-6 h-6 rounded-md flex-shrink-0 flex items-center justify-center text-xs font-semibold">2</span>
                    <p class="text-sm font-medium text-gray-700">*TS Download* ya *MP4 Download* button par click karein.</p>
                </div>
                <div class="flex gap-4 items-start">
                    <span class="bg-indigo-600 text-white w-6 h-6 rounded-md flex-shrink-0 flex items-center justify-center text-xs font-semibold">3</span>
                    <p class="text-sm font-medium text-gray-700">Niche 4 servers mein se koi *1 Select* karein.</p>
                </div>
                <div class="flex gap-4 items-start">
                    <span class="bg-indigo-600 text-white w-6 h-6 rounded-md flex-shrink-0 flex items-center justify-center text-xs font-semibold">4</span>
                    <p class="text-sm font-medium text-gray-700">Dubara *TS/MP4 Download* par click karein, downloading shuru ho jayegi!</p>
                </div>
            </div>
            
            <button onclick="goToDownloader()" class="w-full bg-indigo-600 text-white py-4 rounded-2xl font-semibold uppercase tracking-widest shadow-lg shadow-indigo-200 hover:scale-105 transition-transform">Go to m3u8.dev ‚Üí</button>
        </div>
    </div>

    <div id="loginModal" class="bg-white rounded-[2.5rem] w-full max-w-sm p-10 hidden shadow-2xl">
        <h3 class="text-2xl font-semibold mb-6 text-center uppercase">Admin Access</h3>
        <input id="passInput" type="password" placeholder="Passkey" class="w-full bg-gray-50 p-5 rounded-2xl mb-6 text-center text-2xl font-semibold border-2 border-gray-100 outline-none">
        <button onclick="tryLogin()" class="w-full bg-indigo-600 text-white py-5 rounded-2xl font-semibold uppercase tracking-widest">Verify</button>
    </div>

    <div id="renameModal" class="bg-white rounded-[2.5rem] w-full max-w-sm p-10 hidden shadow-2xl">
        <h3 class="text-xl font-semibold mb-6 text-center uppercase text-indigo-900">Rename Chapter</h3>
        <input id="newNameInput" type="text" placeholder="Enter New Name" class="w-full bg-gray-50 p-5 rounded-2xl mb-6 font-semibold border-2 border-gray-100 outline-none">
        <input type="hidden" id="oldNameStore">
        <div class="flex gap-4">
            <button onclick="closeModals()" class="flex-1 bg-gray-100 py-4 rounded-xl font-semibold uppercase text-[10px]">Cancel</button>
            <button onclick="processRename()" class="flex-1 bg-indigo-600 text-white py-4 rounded-xl font-semibold uppercase text-[10px]">Update All</button>
        </div>
    </div>

    <div id="addModal" class="bg-white rounded-[2.5rem] w-full max-w-xl p-10 hidden max-h-[90vh] overflow-y-auto no-scrollbar">
        <h3 class="text-3xl font-semibold mb-8 uppercase text-indigo-900">Add Content</h3>
        <div class="space-y-4">
            <div class="grid grid-cols-2 gap-4">
                <div class="flex flex-col gap-1">
                    <label class="text-[9px] font-semibold uppercase text-gray-400 ml-2">Platform</label>
                    <select id="vPlatform" class="w-full bg-gray-50 p-5 rounded-2xl border border-gray-100 font-semibold outline-none">
                        <option value="PW">Physics Wallah</option>
                        <option value="NT">Next Toppers</option>
                    </select>
                </div>
                <div class="flex flex-col gap-1">
                    <label class="text-[9px] font-semibold uppercase text-gray-400 ml-2">Subject</label>
                    <input id="vSub" type="text" placeholder="Physics" class="w-full bg-gray-50 p-5 rounded-2xl border border-gray-100 font-semibold outline-none">
                </div>
            </div>
            <input id="vTitle" type="text" placeholder="Lecture Title" class="w-full bg-gray-50 p-5 rounded-2xl border border-gray-100 font-semibold outline-none">
            <input id="vChap" type="text" placeholder="Chapter Name" class="w-full bg-gray-50 p-5 rounded-2xl border border-gray-100 font-semibold outline-none">
            <input id="vUrl" type="text" placeholder="M3U8 Video Link" class="w-full bg-gray-50 p-5 rounded-2xl border border-gray-100 outline-none">
            <div class="grid grid-cols-2 gap-4">
                <input id="vNotes" type="text" placeholder="Lecture Notes PDF" class="w-full bg-gray-50 p-5 rounded-2xl border border-gray-100 outline-none">
                <input id="vChapNotes" type="text" placeholder="DPP / One Pager PDF" class="w-full bg-gray-50 p-5 rounded-2xl border border-gray-100 outline-none">
            </div>
            <textarea id="vCustomDesc" placeholder="Description" class="w-full bg-gray-50 p-5 rounded-2xl border border-gray-100 h-24 font-medium outline-none"></textarea>
            <input type="hidden" id="editId">
            <div class="flex gap-4 pt-4">
                <button onclick="closeModals()" class="flex-1 bg-gray-100 py-5 rounded-2xl font-semibold uppercase text-xs">Cancel</button>
                <button onclick="saveVideo()" class="flex-[2] bg-indigo-600 text-white py-5 rounded-2xl font-semibold uppercase text-xs">Save Content</button>
            </div>
        </div>
    </div>

    <div id="playerModal" class="bg-black rounded-3xl w-full max-w-4xl overflow-hidden hidden shadow-2xl relative">
        <button onclick="closeModals()" class="absolute top-4 right-4 z-50 bg-white/20 text-white p-2 rounded-full hover:bg-white/40">‚úï</button>
        <div class="aspect-video bg-black">
            <video id="hlsVideo" controls autoplay playsinline class="w-full h-full"></video>
        </div>
    </div>
</div>

<footer class="bg-white border-t border-gray-100 py-12 px-8 text-center mt-20">
    <p class="text-[9px] text-gray-400 font-semibold uppercase tracking-[0.3em]">¬© 2024 JITU EDUCATIONAL HUB | SIKSHA SABKE LIYE</p>
</footer>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-app.js";
import { getFirestore, collection, addDoc, onSnapshot, deleteDoc, doc, updateDoc, writeBatch, query, where, getDocs } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-firestore.js";
import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyB1bJg4JrtFmceuAZvJaMXgUUhxCf1UKdo",
  authDomain: "not-13c89.firebaseapp.com",
  projectId: "not-13c89",
  storageBucket: "not-13c89.firebasestorage.app",
  messagingSenderId: "684410233370",
  appId: "1:684410233370:web:0ed671c584120a4fc1a7a3"
};

let db, auth, videoList = [], isAdmin = false, currentSubject = '', currentPlatform = 'PW';
const PASS_KEY = "Jitu9027", COLLECTION_ID = "jitu_ultra_premium_v2";
const SUBJECT_ORDER = ["Physics", "Chemistry", "Maths", "Biology", "English"];
let hlsInstance = null;

// ‚ú® NEW CUSTOM DOWNLOAD HANDLER (NO BROWSER ALERT)
window.handleDownloadLink = (m3u8Url) => {
    // 1. Copy Link to Clipboard
    const tempInput = document.createElement("input");
    tempInput.value = m3u8Url;
    document.body.appendChild(tempInput);
    tempInput.select();
    document.execCommand("copy");
    document.body.removeChild(tempInput);

    // 2. Show Custom Popup
    showModal('downloadStepModal');
};

window.goToDownloader = () => {
    window.open("https://m3u8.dev/", "_blank");
    closeModals();
};

window.handleAction = (type, targetUrl) => {
    if(type === 'video') {
        // Updated Logic: Check if URL contains .m3u8
        if (targetUrl && targetUrl.includes('.m3u8')) {
            playVideo(targetUrl);
        } else {
            // Otherwise open in new tab (YouTube, Drive, etc.)
            window.open(targetUrl, '_blank');
        }
    }
    else window.open(targetUrl, '_blank');
};

async function startup() {
    const app = initializeApp(firebaseConfig);
    db = getFirestore(app); auth = getAuth(app);
    await signInAnonymously(auth);
    onAuthStateChanged(auth, user => { if(user) listen(); });
}

function listen() {
    onSnapshot(collection(db, 'artifacts', COLLECTION_ID, 'public', 'data', 'videos'), snap => {
        videoList = snap.docs.map(d => ({ id: d.id, ...d.data() }));
        if(videoList.length > 0 && !currentSubject) {
            const platformVids = videoList.filter(v => (v.platform || 'NT') === currentPlatform);
            const availableSubs = [...new Set(platformVids.map(v => v.subject))];
            currentSubject = SUBJECT_ORDER.find(s => availableSubs.includes(s)) || availableSubs[0];
        }
        document.getElementById('globalLoader')?.remove();
        render();
    });
}

const naturalSort = (a, b) => a.localeCompare(b, undefined, { numeric: true, sensitivity: 'base' });

window.render = () => {
    const subList = document.getElementById('subjectList');
    const verticalCont = document.getElementById('verticalContent');
    const search = document.getElementById('searchInput').value.toLowerCase();
    
    if (isAdmin) document.getElementById('addBtn').classList.remove('hidden');

    let platformVids = videoList.filter(v => (v.platform || 'NT') === currentPlatform);
    const uniqueSubs = [...new Set(platformVids.map(v => v.subject))].sort((a,b) => SUBJECT_ORDER.indexOf(a) - SUBJECT_ORDER.indexOf(b));
    
    subList.innerHTML = uniqueSubs.map(s => `<button onclick="selectSubject('${s}')" class="sub-pill px-6 py-3 rounded-xl text-[10px] font-semibold uppercase whitespace-nowrap transition-all ${currentSubject === s ? 'active' : ''}">${s}</button>`).join('');

    let subVideos = platformVids.filter(v => v.subject === currentSubject && (v.title.toLowerCase().includes(search) || (v.chapter || '').toLowerCase().includes(search)));
    subVideos.sort((a, b) => naturalSort(a.title, b.title));
    
    const chapters = [...new Set(subVideos.map(v => v.chapter || 'General'))].sort(naturalSort);
    document.getElementById('emptyState').classList.toggle('hidden', subVideos.length > 0);

    verticalCont.innerHTML = chapters.map((chap, idx) => {
        const chapVideos = subVideos.filter(v => (v.chapter || 'General') === chap);
        const chapOnePager = chapVideos.find(v => v.chapNotes)?.chapNotes;

        return `
            <div class="chapter-accordion" id="chap-${idx}">
                <div class="chapter-header" onclick="toggleChapter(event, ${idx})">
                    <div class="flex items-center gap-4">
                        <span class="w-8 h-8 bg-indigo-50 text-indigo-600 rounded-lg flex items-center justify-center font-semibold text-xs">${idx + 1}</span>
                        <div class="flex flex-col">
                           <h3 class="font-semibold text-lg uppercase tracking-tight text-gray-800">${chap}</h3>
                           ${isAdmin ? `<button onclick="openRenameModal('${chap}')" class="mt-1 text-[8px] font-semibold text-indigo-500 uppercase bg-indigo-50 px-2 py-1 rounded w-fit">Edit Name</button>` : ''}
                        </div>
                    </div>
                    <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M19 9l-7 7-7-7"></path></svg>
                </div>
                <div class="chapter-content">
                    ${chapOnePager ? `
                        <div class="mb-6 p-4 bg-indigo-600 rounded-2xl flex items-center justify-between text-white shadow-lg">
                            <h4 class="font-semibold uppercase text-xs">Chapter DPP / Revision Notes</h4>
                            <button onclick="handleAction('pdf', '${chapOnePager}')" class="bg-white text-indigo-600 px-4 py-2 rounded-xl text-[9px] font-semibold uppercase">Open PDF</button>
                        </div>
                    ` : ''}
                    <div class="space-y-3">
                        ${chapVideos.map(v => `
                            <div class="resource-card">
                                <div class="flex flex-col md:flex-row md:items-center justify-between gap-4">
                                    <div class="flex-1">
                                        <h4 class="font-semibold text-sm uppercase text-gray-800 mb-1">${v.title}</h4>
                                        <p class="text-[10px] text-gray-500 font-medium line-clamp-1">${v.customDescription || 'Premium Educational Resource'}</p>
                                    </div>
                                    <div class="flex flex-wrap gap-2">
                                        <button onclick="handleAction('video', '${v.m3u8Url}')" class="bg-indigo-600 text-white px-5 py-2.5 rounded-lg text-[9px] font-semibold uppercase">Play</button>
                                        <button onclick="handleDownloadLink('${v.m3u8Url}')" class="bg-green-600 text-white px-5 py-2.5 rounded-lg text-[9px] font-semibold uppercase">Download</button>
                                        ${v.notes ? `<button onclick="handleAction('pdf', '${v.notes}')" class="bg-white border border-gray-200 text-gray-600 px-5 py-2.5 rounded-lg text-[9px] font-semibold uppercase">Notes</button>` : ''}
                                        ${isAdmin ? `<button onclick="editEntry('${v.id}')" class="bg-indigo-50 text-indigo-600 p-2.5 rounded-lg text-[9px] font-semibold">Edit</button>` : ''}
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            </div>
        `;
    }).join('');
};

window.openRenameModal = (chap) => {
    document.getElementById('oldNameStore').value = chap;
    document.getElementById('newNameInput').value = chap;
    showModal('renameModal');
};

window.processRename = async () => {
    const oldName = document.getElementById('oldNameStore').value;
    const newName = document.getElementById('newNameInput').value.trim();
    if (newName && newName !== oldName) {
        const batch = writeBatch(db);
        const q = query(collection(db, 'artifacts', COLLECTION_ID, 'public', 'data', 'videos'), where("chapter", "==", oldName), where("subject", "==", currentSubject));
        const snap = await getDocs(q);
        snap.forEach((docRef) => batch.update(docRef.ref, { chapter: newName }));
        await batch.commit();
        closeModals();
    } else closeModals();
};

window.selectPlatform = (p) => {
    currentPlatform = p;
    document.querySelectorAll('.platform-card').forEach(c => c.classList.remove('active'));
    document.getElementById(`plat-${p}`).classList.add('active');
    render();
};

window.toggleChapter = (event, idx) => {
    if (event.target.closest('button')) return;
    const el = document.getElementById(`chap-${idx}`);
    const isOpen = el.classList.contains('open');
    document.querySelectorAll('.chapter-accordion').forEach(acc => acc.classList.remove('open'));
    if (!isOpen) el.classList.add('open');
};

window.playVideo = (url) => {
    const video = document.getElementById('hlsVideo');
    showModal('playerModal');
    if (hlsInstance) hlsInstance.destroy();
    if (Hls.isSupported()) {
        hlsInstance = new Hls();
        hlsInstance.loadSource(url);
        hlsInstance.attachMedia(video);
        hlsInstance.on(Hls.Events.MANIFEST_PARSED, () => video.play());
    } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
        video.src = url;
    }
};

window.saveVideo = async () => {
    const title = document.getElementById('vTitle').value, m3u8 = document.getElementById('vUrl').value, eId = document.getElementById('editId').value;
    if(title && m3u8) {
        const data = { 
            title, subject: document.getElementById('vSub').value, chapter: document.getElementById('vChap').value || 'General',
            platform: document.getElementById('vPlatform').value, m3u8Url: m3u8, notes: document.getElementById('vNotes').value,
            chapNotes: document.getElementById('vChapNotes').value, customDescription: document.getElementById('vCustomDesc').value, updatedAt: Date.now() 
        };
        if(eId) await updateDoc(doc(db, 'artifacts', COLLECTION_ID, 'public', 'data', 'videos', eId), data);
        else await addDoc(collection(db, 'artifacts', COLLECTION_ID, 'public', 'data', 'videos'), { ...data, createdAt: Date.now() });
        closeModals();
    }
};

window.editEntry = (id) => {
    const v = videoList.find(i => i.id === id);
    if(!v) return;
    document.getElementById('editId').value = v.id;
    document.getElementById('vPlatform').value = v.platform || "NT";
    document.getElementById('vTitle').value = v.title;
    document.getElementById('vSub').value = v.subject;
    document.getElementById('vChap').value = v.chapter;
    document.getElementById('vUrl').value = v.m3u8Url || "";
    document.getElementById('vNotes').value = v.notes || "";
    document.getElementById('vChapNotes').value = v.chapNotes || "";
    document.getElementById('vCustomDesc').value = v.customDescription || "";
    showModal('addModal');
};

window.selectSubject = (s) => { currentSubject = s; render(); };
window.tryLogin = () => { if(document.getElementById('passInput').value === PASS_KEY) { isAdmin = true; closeModals(); render(); } };
window.showModal = (id) => { 
    const o = document.getElementById('modalOverlay'); 
    o.classList.remove('hidden'); o.classList.add('flex'); 
    document.getElementById(id).classList.remove('hidden'); 
    setTimeout(() => o.style.opacity = '1', 50); 
};
window.closeModals = () => { 
    const v = document.getElementById('hlsVideo'); if(v) v.pause();
    document.getElementById('modalOverlay').style.opacity = '0'; 
    setTimeout(() => {
        document.getElementById('modalOverlay').classList.add('hidden');
        ['loginModal','addModal','playerModal', 'renameModal', 'downloadStepModal'].forEach(m => document.getElementById(m).classList.add('hidden'));
    }, 300); 
};
window.openLoginModal = () => isAdmin ? (isAdmin = false, location.reload()) : showModal('loginModal');
window.openAddModal = () => { ['vTitle','vUrl','vSub','vChap','vNotes','vChapNotes','vCustomDesc','editId'].forEach(i=>document.getElementById(i).value=""); showModal('addModal'); };
document.getElementById('searchInput').addEventListener('input', render);
startup();
</script>
</body>
                </html>
